<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>数字神谕 - 木星核心</title>
    <style>
        :root {
            --gold: #fceabb;
            --sub-gold: #b8a47e;
            --white: #ffffff;
            --text-shadow: 0 0 12px rgba(0,0,0,1), 0 0 20px rgba(0,0,0,1);
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #000; 
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif; 
            color: var(--white); 
            -webkit-tap-highlight-color: transparent;
        }

        #shader-canvas { 
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%; z-index: 0; 
        }
        
        #ui-layer {
            position: relative; z-index: 1; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center; 
            pointer-events: none;
        }

        .oracle-card {
            width: 92%; max-width: 500px;
            padding: 20px;
            background: transparent; 
            text-align: center;
            pointer-events: auto;
            box-sizing: border-box;
        }

        .sys-info {
            font-size: 10px; letter-spacing: 5px; color: rgba(255, 255, 255, 0.4);
            margin-bottom: 2rem; text-transform: uppercase; text-shadow: var(--text-shadow);
        }

        .energy-counter {
            font-size: 0.8rem; color: var(--sub-gold);
            margin-bottom: 1rem; text-shadow: var(--text-shadow);
        }

        /* 签位名称样式优化 */
        .sign-pos { 
            font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--gold); 
            display: none; text-shadow: var(--text-shadow); 
            letter-spacing: 1px;
        }

        .sign-verse { 
            font-size: 1.2rem; line-height: 1.8; margin-bottom: 2.5rem; color: var(--white); 
            display: none; text-shadow: var(--text-shadow); font-style: italic;
        }
        
        .result-box { 
            text-align: left; border-top: 1px solid rgba(255, 255, 255, 0.2); 
            padding-top: 1.5rem; display: none; 
        }

        .result-label { 
            font-size: 0.75rem; color: var(--sub-gold); 
            margin-bottom: 0.6rem; font-weight: bold; letter-spacing: 2px; 
        }

        .result-text { 
            font-size: 0.95rem; color: #efefef; line-height: 1.7; 
            margin-bottom: 1.5rem; text-shadow: var(--text-shadow);
        }

        .controls {
            display: flex; flex-direction: column; align-items: center;
            margin-top: 1rem;
        }

        .btn {
            background: transparent; border: 1.5px solid rgba(255, 255, 255, 0.5);
            color: #fff; padding: 0.8rem 2.5rem; font-size: 0.9rem; 
            cursor: pointer; transition: all 0.3s; 
            text-transform: uppercase; letter-spacing: 2px;
            width: auto; min-width: 160px;
            border-radius: 2px;
            margin: 0.5rem 0;
        }

        .btn:hover:not(:disabled) { background: #fff; color: #000; box-shadow: 0 0 15px rgba(255,255,255,0.3); }
        .btn:active { transform: scale(0.95); opacity: 0.8; }
        .btn:disabled { color: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.1); cursor: not-allowed; }

        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media screen and (max-width: 480px) {
            .sign-pos { font-size: 1.3rem; }
            .sign-verse { font-size: 1.05rem; }
            .result-text { font-size: 0.9rem; }
            .btn { width: 85%; }
        }
    </style>
</head>
<body>

<canvas id="shader-canvas"></canvas>

<div id="ui-layer">
    <div class="oracle-card">
        <div class="sys-info">Digital Oracle // Jupiter Core</div>
        <div id="energy-display" class="energy-counter">载入中...</div>
        
        <div id="sign-pos" class="sign-pos"></div>
        <div id="sign-verse" class="sign-verse"></div>

        <div id="interpret-box" class="result-box">
            <div class="result-label">状态映射 // DECODING</div>
            <div id="sign-desc" class="result-text"></div>
            <div class="result-label">今日建议 // ACTION</div>
            <div id="sign-action" class="result-text"></div>
        </div>

        <div class="controls" id="controls">
            <button id="btn-draw" class="btn" onclick="handleDraw()">开启感应</button>
            <button id="btn-interpret" class="btn" style="display:none;" onclick="handleInterpret()">读取深意</button>
            <button id="btn-next" class="btn" style="display:none;" onclick="resetUI()">再次连接</button>
        </div>
    </div>
</div>

<script>
    // --- 签文数据库 ---
    const database = [
        { pos: "状态特征：稀薄大气", verse: "高处的风凛冽，<br>却能看清云层下的真相。", desc: "你最近可能感到有些孤立无援。其实这正是你脱离混乱、建立全局观的最佳时刻。", action: "从旁观者的角度重新审视现在的烦恼，你会发现它比想象中小。" },
        { pos: "状态特征：卫星凌日", verse: "短暂的遮蔽并非终结，<br>阴影过后，光芒将更加纯粹。", desc: "有人或事暂时掩盖了你的光芒。没关系，这只是运行轨道的必然，耐心等待阴影移开。", action: "今天不要急于证明自己，保持低调，默默积蓄能量。" },
        { pos: "状态特征：核心重力", verse: "万物皆向你汇聚，<br>因为你找到了自己的重心。", desc: "你的状态正在变得稳固。这种引力源于你内在的定力，不要被外界的波动轻易带走。", action: "坚定执行你今日的第一个计划，关掉通知，只做事。" },
        { pos: "状态特征：冰晶环带", verse: "细碎的尘埃聚集，<br>也能构建环绕行星的光环。", desc: "不要轻视细微的进步。每天一点点的积累，正在你不知觉中构建起宏大的成就。", action: "记录今天完成的三个小确幸或小成就，无论多么微不足道。" },
        { pos: "状态特征：极光律动", verse: "能量在无声处爆发，<br>在黑暗中，你才是最绚烂的注脚。", desc: "你可能觉得自己做的事情没人看到。其实你的能量正在暗处产生影响，某种惊喜正在孕育中。", action: "给那个一直支持你的人发个感谢，或者分享一张你喜欢的照片。" },
        { pos: "状态特征：气体流变", verse: "没有形态就是最好的形态，<br>随风起舞，也是一种对抗。", desc: "不要死磕。如果一件事让你感到巨大的阻力，试着绕过去，换个思维方式可能就通了。", action: "尝试用一个全新的角度去思考今天最棘手的那个任务。" },
        { pos: "状态特征：磁层护盾", verse: "抵御风暴的不是盔甲，<br>而是你内心那道看不见的屏障。", desc: "外界评价最近比较嘈杂。只要你不从心底认可那些负面信息，它们就无法真正伤害你。", action: "有意识地屏蔽那个让你焦虑的信息源，哪怕只屏蔽这一天。" },
        { pos: "状态特征：卫星逃逸", verse: "松开多余的束缚，<br>你将飞向更广阔的星辰。", desc: "你是不是抓得太紧了？某些已经不再适合你的关系或旧习惯，该放手时就放手。", action: "主动放弃一个你坚持了很久但已让你感到疲惫的负重。" },
        { pos: "状态特征：永恒红斑", verse: "风暴中心最安静，<br>在喧嚣中，寻找你的避风港。", desc: "外界再乱，内心也可以拥有一片净土。这种平衡感是你最大的天赋。", action: "午休或睡前静坐 5 分钟，关掉感官，彻底放空。" },
        { pos: "状态特征：潮汐锁定", verse: "始终如一的注视，<br>本身就是一种深情。", desc: "专注力是你现在的王牌。认定一个方向，不要被旁边闪烁的小利带偏了航向。", action: "设定一个 60 分钟的专注闹钟，期间不处理任何杂碎信息。" },
        { pos: "状态特征：轨道摄动", verse: "微小的偏离轨迹，<br>带你去向未曾设想的终点。", desc: "意料之外的变数未必是坏事。它可能是在帮你避开一个原本注定的平庸结局。", action: "拥抱今天那个小小的意外，顺着它的节奏看看会发生什么。" },
        { pos: "状态特征：辐射余晖", verse: "散去的热量，<br>依然在温暖着寒冷的深空。", desc: "你过去的付出并没有白费。它们现在正化作无形的人脉或经验，在背后支撑着你。", action: "翻看一张老照片或一段旧文字，你会发现自己已经走了很远。" },
        { pos: "状态特征：奇点坍缩", verse: "极致的收敛，<br>是为了下一次大爆炸的诞生。", desc: "如果你感到无力或沉默，这其实是在积压能量。现在的沉默是为了未来的爆发。", action: "今晚适合早点休息，推掉无用的社交，享受孤独。" },
        { pos: "状态特征：星云弥散", verse: "模糊的边缘，<br>孕育着无限可能的可能。", desc: "目前状态有些模糊不清？不要急着定义。在混沌中生长的东西，往往最具有创造力。", action: "画一张草图或写一段随笔，捕捉脑中那些一闪而过的念头。" },
        { pos: "状态特征：超新星余迹", verse: "毁灭亦是新生，<br>旧的尘埃将成为新的星群。", desc: "某段关系的结束或项目的终止，其实是腾出了空间。星尘会重新聚集。", action: "整理一下衣柜或办公桌，丢掉那些你不再需要的东西。" },
        { pos: "状态特征：双星共舞", verse: "在旋转的引力中，<br>找到彼此共存的律动。", desc: "合作与沟通是今天的主题。找到那个与你节奏互补的人，1+1 会远大于 2。", action: "主动邀请一位合作伙伴或朋友进行一次深度的对话。" }
    ];

    // 自动补齐至 60 支，确保长期可用性
    const subjects = ["概率波动", "能量坍缩", "相位偏移", "频率共振", "逻辑链路", "意识切片", "时空扰动"];
    for (let i = database.length; i < 60; i++) {
        const sub = subjects[i % subjects.length];
        database.push({
            pos: `状态特征：${sub}`,
            verse: "流动的代码无迹可寻，<br>唯有信念是唯一的座标。",
            desc: "这是系统感应到的动态路径。意味着你目前拥有极高的自由度，任何选择都是正确的起点。",
            action: "掷一次硬币，或随机听一首歌，让第一个灵感决定你下一步的行动。"
        });
    }

    // --- 核心逻辑 ---
    let state = { date: "", count: 3 };

    function initSystem() {
        const saved = localStorage.getItem('jupiter_oracle_state_v6');
        const today = new Date().toLocaleDateString();
        if (saved) {
            const parsed = JSON.parse(saved);
            state = (parsed.date === today) ? parsed : { date: today, count: 3 };
        } else {
            state = { date: today, count: 3 };
        }
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById('energy-display').innerText = `每日感应余量: ${state.count} / 3`;
        localStorage.setItem('jupiter_oracle_state_v6', JSON.stringify(state));
        if (state.count <= 0) {
            const btnDraw = document.getElementById('btn-draw');
            btnDraw.disabled = true;
            btnDraw.innerText = "能量已耗尽";
        }
    }

    function handleDraw() {
        if (state.count <= 0) return;
        const sign = database[Math.floor(Math.random() * database.length)];
        state.count--;
        updateDisplay();
        document.getElementById('btn-draw').style.display = 'none';
        const pos = document.getElementById('sign-pos');
        const verse = document.getElementById('sign-verse');
        pos.innerText = sign.pos;
        verse.innerHTML = sign.verse;
        pos.style.display = 'block'; verse.style.display = 'block';
        pos.classList.remove('fade-in'); void pos.offsetWidth;
        pos.classList.add('fade-in'); verse.classList.add('fade-in');
        window._currentSign = sign;
        document.getElementById('btn-interpret').style.display = 'inline-block';
    }

    function handleInterpret() {
        document.getElementById('btn-interpret').style.display = 'none';
        const sign = window._currentSign;
        document.getElementById('sign-desc').innerText = sign.desc;
        document.getElementById('sign-action').innerText = sign.action;
        const box = document.getElementById('interpret-box');
        box.style.display = 'block'; box.classList.add('fade-in');
        document.getElementById('btn-next').style.display = 'inline-block';
    }

    function resetUI() {
        document.getElementById('sign-pos').style.display = 'none';
        document.getElementById('sign-verse').style.display = 'none';
        document.getElementById('interpret-box').style.display = 'none';
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('btn-draw').style.display = 'inline-block';
    }

    // --- 木星 Shader (响应式优化版) ---
    const canvas = document.querySelector('#shader-canvas');
    const gl = canvas.getContext('webgl');
    const vs = `attribute vec2 p; void main(){ gl_Position=vec4(p,0,1); }`;
    const fs = `
        precision mediump float;
        uniform vec3 iResolution;
        uniform float iTime;
        float rand(vec2 co, float seed){ return fract(sin(dot(co.xy + seed ,vec2(12.9898,78.233))) * 43758.5453); }
        vec3 makeJupiter(vec2 uv) {
            float time = iTime * 0.4;
            vec2 zoom = vec2(20.,5.5); vec2 offset = vec2(2.,1.);
            vec2 point = uv * zoom + offset;
            float a_x = .2; float a_y = .3;
            for(int i=1; i<10; i++){
                float f_i = float(i); 
                point.x += a_x*sin(f_i*point.y+time);
                point.y += a_y*cos(f_i*point.x+time*0.8);
            }
            float r = cos(point.x+point.y+2.)*.5+.5;
            float g = sin(point.x+point.y+2.2)*.5+.5;
            float b = (sin(point.x+point.y+1.)+cos(point.x+point.y+1.5))*.5+.5;
            return vec3(r,g,b) + vec3(.4);
        }
        void main() {
            vec2 res = iResolution.xy;
            vec2 fC = gl_FragCoord.xy;
            vec2 uv = fC / res.xy;
            vec2 texCoord = vec2(uv.y, uv.x);
            vec2 center = res.xy / 2.;
            float dis = distance(center, fC);
            float radius = min(res.x, res.y) * 0.38; 
            vec3 atmosphereColor = vec3(.7, .6, .5);
            if (dis < radius) {
                vec2 pP = (fC - (center - radius)) / (radius * 2.0);
                pP = pP * 2.0 - 1.0;
                float sD = length(pP);
                sD = 1.0 - pow(max(0.0, 1.0 - sD), .6);
                pP = normalize(pP) * sD; pP = (pP + 1.0) / 2.0;
                float light = pow(max(0.0, pP.x), 2.0*(cos(iTime*.1 +1.)+1.5));
                vec3 sC = makeJupiter(texCoord) * light;
                float fI = pow(dis / radius, 3.0);
                vec3 fres = mix(sC, atmosphereColor, fI * pow(max(0.0, pP.x), 2.0));
                gl_FragColor = vec4(fres * uv.x * 2.2, 1.0);
            } else {
                float sA = rand(fC, 0.0);
                vec3 bg = (sA < .008) ? vec3(clamp(sA * 250.0, .1, .3)) : vec3(0);
                float outter = pow(clamp((1.0 - (dis/radius)*0.6), 0.0, 1.0), 3.0);
                gl_FragColor = vec4(bg + atmosphereColor * outter * 0.4, 1.0);
            }
        }
    `;
    function createShader(gl, type, src) { const s = gl.createShader(type); gl.shaderSource(s, src); gl.compileShader(s); return s; }
    const prog = gl.createProgram();
    gl.attachShader(prog, createShader(gl, gl.VERTEX_SHADER, vs));
    gl.attachShader(prog, createShader(gl, gl.FRAGMENT_SHADER, fs));
    gl.linkProgram(prog); gl.useProgram(prog);
    const buf = gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER, buf);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]), gl.STATIC_DRAW);
    const pLoc = gl.getAttribLocation(prog, "p"); gl.enableVertexAttribArray(pLoc); gl.vertexAttribPointer(pLoc, 2, gl.FLOAT, false, 0, 0);
    const iTimeLoc = gl.getUniformLocation(prog, "iTime");
    const iResLoc = gl.getUniformLocation(prog, "iResolution");
    function render(time) {
        const dpr = window.devicePixelRatio || 1;
        canvas.width = window.innerWidth * dpr;
        canvas.height = window.innerHeight * dpr;
        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.uniform1f(iTimeLoc, time * 0.001);
        gl.uniform3f(iResLoc, canvas.width, canvas.height, 1.0);
        gl.drawArrays(gl.TRIANGLES, 0, 6);
        requestAnimationFrame(render);
    }
    requestAnimationFrame(render);
    window.onload = initSystem;
</script>
</body>
</html>
